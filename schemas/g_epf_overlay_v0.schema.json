{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "G-EPF overlay v0",
  "description": "Shadow-only EPF diagnostic overlay for G-field / EPF. v0 contract.",
  "type": "object",
  "required": ["version", "created_at", "source", "panels"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Overlay version identifier (kept for v0 compatibility)."
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp when this overlay JSON was created."
    },
    "source": {
      "type": "string",
      "description": "Short string describing the overlay source (demo, pipeline, etc.)."
    },

    "meta": {
      "type": "object",
      "description": "Additional metadata for the EPF overlay.",
      "properties": {
        "overlay_id": { "type": "string" },
        "epf_version": { "type": "string" },
        "generated_at": { "type": "string", "format": "date-time" },
        "source_run_id": { "type": "string" },
        "source_files": {
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "additionalProperties": true
    },

    "summary": {
      "type": "object",
      "description": "Top-level summary counters for the EPF overlay.",
      "properties": {
        "total_gates": { "type": "integer", "minimum": 0 },
        "gates_in_epf_band": { "type": "integer", "minimum": 0 },
        "gates_changed_by_epf": { "type": "integer", "minimum": 0 },
        "gates_with_paradox_flag": { "type": "integer", "minimum": 0 },
        "shadow_pass": { "type": "boolean" },
        "notes": {
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "additionalProperties": true
    },

    "panels": {
      "type": "array",
      "description": "Per-gate EPF diagnostic panels.",
      "items": {
        "$ref": "#/definitions/panel"
      }
    },

    "g_field": {
      "type": "object",
      "description": "Reserved for G-field / EPF cross-linking or extra diagnostics.",
      "additionalProperties": true
    },

    "diagnostics": {
      "type": "object",
      "description": "Free-form diagnostics for EPF configuration, band, etc.",
      "additionalProperties": true
    }
  },
  "additionalProperties": false,
  "definitions": {
    "panel": {
      "type": "object",
      "required": ["gate_id", "baseline_decision"],
      "properties": {
        "panel_id": {
          "type": "string",
          "description": "Stable identifier for this EPF panel."
        },
        "gate_id": {
          "type": "string",
          "description": "ID of the gate this panel refers to (e.g. q1_grounded_ok)."
        },
        "baseline_decision": {
          "type": "string",
          "description": "Deterministic baseline decision for the gate."
        },
        "epf_shadow_decision": {
          "type": "string",
          "description": "EPF shadow decision for the gate (never used for CI gating)."
        },
        "in_epf_band": {
          "type": "boolean",
          "description": "True if the gate is inside the EPF band around the threshold."
        },
        "distance_to_threshold": {
          "type": ["number", "null"],
          "description": "Absolute distance to the gate threshold (if available)."
        },
        "epf_L": {
          "type": ["number", "null"],
          "description": "Local contraction proxy for the EPF layer (if available)."
        },
        "risk_band": {
          "type": "string",
          "description": "Optional risk band label (e.g. low/medium/high)."
        },
        "paradox": {
          "type": "object",
          "description": "Optional paradox metadata for this gate.",
          "properties": {
            "has_paradox": { "type": "boolean" },
            "paradox_type": { "type": "string" },
            "severity": { "type": "string" },
            "summary": { "type": "string" }
          },
          "additionalProperties": true
        },
        "metrics": {
          "type": "object",
          "description": "Numeric metrics for baseline vs EPF.",
          "properties": {
            "baseline_value": { "type": ["number", "null"] },
            "epf_value": { "type": ["number", "null"] }
          },
          "additionalProperties": true
        },
        "notes": {
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "additionalProperties": true
    }
  }
}
