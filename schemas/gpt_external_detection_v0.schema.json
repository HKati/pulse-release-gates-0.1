{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "gpt_external_detection_v0 overlay",
  "description": "Contract for the external GPT/vendor detection overlay produced by gpt_external_detector.py.",
  "type": "object",
  "additionalProperties": true,
  "required": [
    "version",
    "created_at",
    "input_file",
    "summary",
    "records"
  ],
  "properties": {
    "version": {
      "type": "string",
      "const": "gpt_external_detection_v0"
    },
    "created_at": {
      "type": "string",
      "format": "date-time"
    },
    "input_file": {
      "type": "string",
      "description": "Path to the input JSONL log file used by the detector."
    },
    "summary": {
      "type": "object",
      "additionalProperties": true,
      "required": [
        "total_records",
        "num_external_gpt",
        "num_internal",
        "num_unknown",
        "vendors",
        "models"
      ],
      "properties": {
        "total_records": {
          "type": "integer",
          "minimum": 0
        },
        "num_external_gpt": {
          "type": "integer",
          "minimum": 0
        },
        "num_internal": {
          "type": "integer",
          "minimum": 0
        },
        "num_unknown": {
          "type": "integer",
          "minimum": 0
        },
        "vendors": {
          "type": "object",
          "description": "Map of vendor name (lowercased) to count.",
          "additionalProperties": {
            "type": "integer",
            "minimum": 0
          }
        },
        "models": {
          "type": "object",
          "description": "Map of model name (lowercased) to count.",
          "additionalProperties": {
            "type": "integer",
            "minimum": 0
          }
        }
      }
    },
    "records": {
      "type": "array",
      "minItems": 0,
      "items": {
        "type": "object",
        "additionalProperties": true,
        "required": [
          "idx",
          "is_external_gpt",
          "is_internal",
          "reason"
        ],
        "properties": {
          "idx": {
            "type": "integer",
            "minimum": 1,
            "description": "1-based line index in the input JSONL file."
          },
          "id": {
            "type": ["string", "null"],
            "description": "Optional request / trace id associated with the record."
          },
          "is_external_gpt": {
            "type": "boolean"
          },
          "is_internal": {
            "type": "boolean"
          },
          "vendor": {
            "type": ["string", "null"]
          },
          "model": {
            "type": ["string", "null"]
          },
          "reason": {
            "type": "string",
            "description": "Short explanation of the detection decision."
          }
        }
      }
    }
  }
}
