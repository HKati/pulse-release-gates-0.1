name: Make OG image (1200x630)

on:
  workflow_dispatch:
    inputs:
      source:
        description: 'Source image path'
        default: 'hero_dark_4k.png'
        required: true
      bgcolor:
        description: 'Background color'
        default: '#000000'
        required: true

jobs:
  make_og:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - run: pip install pillow
      - name: Generate og_image_1200x630.png
        run: |
          python - <<'PY'
          from PIL import Image, ImageOps
          import os
          src = os.environ.get('SRC','hero_dark_4k.png')
          out = 'og_image_1200x630.png'
          W,H = 1200,630
          bg = os.environ.get('BGCOLOR','#000000')
          im = Image.open(src).convert('RGB')
          im2 = ImageOps.contain(im, (W,H))  # arányt tart, nem vág
          canvas = Image.new('RGB',(W,H),bg)
          canvas.paste(im2, ((W - im2.width)//2, (H - im2.height)//2))
          canvas.save(out, 'PNG')
          print('wrote', out)
          PY
        env:
          SRC: ${{ github.event.inputs.source }}
          BGCOLOR: ${{ github.event.inputs.bgcolor }}
      - name: Commit OG image
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add og_image_1200x630.png
          if git diff --cached --quiet; then
            echo "No changes"; exit 0
          fi
          git commit -m "chore(assets): regenerate og_image_1200x630.png"
          git push
